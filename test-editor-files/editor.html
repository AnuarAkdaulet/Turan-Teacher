<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Тест по физике: Кинематика и Динамика</title>
  <script type="text/javascript" src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <h2>Создание и редактирование HTML-тестов</h2>

  <!-- Кнопки для управления тестом -->
  <button onclick="startNewTest()">Создать новый тест</button>
  <input type="file" id="fileInput" accept=".html">
  <button onclick="loadHTML()">Загрузить существующий HTML-тест</button>

  <!-- Поля для ввода и редактирования вопросов и ответов -->
  <div id="questions"></div>

  <!-- Кнопки для сохранения -->
  <button onclick="saveAsHTML()">Сохранить как HTML</button>

  <!-- Скрытое поле для передачи данных на страницу студента -->
  <textarea id="hiddenTestData" style="display:none"></textarea>

  <!-- Элемент для отображения результата -->
  <div id="result"></div>

  <script type="text/javascript">
    let questions = [];

    // Функция для начала нового теста с нуля
    function startNewTest() {
      questions = [];  // Очистить список вопросов
      document.getElementById('questions').innerHTML = '';  // Очистить форму
      addQuestion();  // Добавить первый вопрос
    }

    // Функция для добавления нового вопроса в тест
    function addQuestion() {
      let questionIndex = questions.length + 1;
      document.getElementById('questions').insertAdjacentHTML('beforeend', `
        <div class="question">
          <label>Вопрос ${questionIndex}:</label>
          <input type="text" class="question-text" placeholder="Введите текст вопроса"><br>
          <label>Ответ A:</label>
          <input type="text" class="answer" placeholder="Ответ A"><br>
          <label>Ответ B:</label>
          <input type="text" class="answer" placeholder="Ответ B"><br>
          <label>Правильный ответ:</label>
          <input type="radio" name="correct${questionIndex}" value="A"> A
          <input type="radio" name="correct${questionIndex}" value="B"> B<br><br>
        </div>
      `);
      questions.push({ questionText: '', answers: ['', ''], correct: '' });
    }

    // Функция для загрузки HTML-файла и автоматического заполнения формы
    function loadHTML() {
      let file = document.getElementById('fileInput').files[0];
      if (!file) {
        alert("Пожалуйста, выберите файл HTML.");
        return;
      }

      let reader = new FileReader();
      reader.onload = function(event) {
        let htmlContent = event.target.result;
        parseHTML(htmlContent);
      };
      reader.readAsText(file);
    }

    // Парсинг HTML-файла и автоматическое заполнение формы
    function parseHTML(htmlContent) {
      let parser = new DOMParser();
      let doc = parser.parseFromString(htmlContent, 'text/html');
      let questionElements = doc.querySelectorAll('.question'); // Ищем все вопросы в HTML

      if (!questionElements.length) {
        alert("Не удалось найти вопросы в загруженном HTML-файле.");
        return;
      }

      // Очистить предыдущие данные
      questions = [];
      document.getElementById('questions').innerHTML = '';

      // Обработка и добавление загруженных вопросов
      questionElements.forEach((element, index) => {
        let questionText = element.querySelector('.question-text').value;
        let answerA = element.querySelectorAll('.answer')[0].value;
        let answerB = element.querySelectorAll('.answer')[1].value;
        let correctAnswer = element.querySelector(`input[name="correct${index + 1}"]:checked`) ? element.querySelector(`input[name="correct${index + 1}"]:checked`).value : '';

        questions.push({ questionText: questionText, answers: [answerA, answerB], correct: correctAnswer });

        // Заполнение формы с загруженными данными
        document.getElementById('questions').insertAdjacentHTML('beforeend', `
          <div class="question">
            <label>Вопрос ${index + 1}:</label>
            <input type="text" class="question-text" value="${questionText}"><br>
            <label>Ответ A:</label>
            <input type="text" class="answer" value="${answerA}"><br>
            <label>Ответ B:</label>
            <input type="text" class="answer" value="${answerB}"><br>
            <label>Правильный ответ:</label>
            <input type="radio" name="correct${index + 1}" value="A" ${correctAnswer === 'A' ? 'checked' : ''}> A
            <input type="radio" name="correct${index + 1}" value="B" ${correctAnswer === 'B' ? 'checked' : ''}> B<br><br>
          </div>
        `);
      });
    }

    // Сохранение как новый HTML-файл
    function saveAsHTML() {
      let htmlContent = `
      <!DOCTYPE html>
      <html>
      <head>
        <title>Редактированный тест</title>
      </head>
      <body>
        <h2>Редактированный тест</h2>
      `;

      let questionDivs = document.querySelectorAll('.question');
      questionDivs.forEach((div, index) => {
        let questionText = div.querySelector('.question-text').value;
        let answers = div.querySelectorAll('.answer');
        let correctAnswer = div.querySelector(`input[name="correct${index + 1}"]:checked`).value;

        htmlContent += `<div class="question">
          <label>Вопрос ${index + 1}:</label>
          <input type="text" class="question-text" value="${questionText}"><br>
          <label>Ответ A:</label>
          <input type="text" class="answer" value="${answers[0].value}"><br>
          <label>Ответ B:</label>
          <input type="text" class="answer" value="${answers[1].value}"><br>
          <label>Правильный ответ:</label>
          <input type="radio" name="correct${index + 1}" value="A" ${correctAnswer === 'A' ? 'checked' : ''}> A
          <input type="radio" name="correct${index + 1}" value="B" ${correctAnswer === 'B' ? 'checked' : ''}> B
        </div><br>`;
      });

      htmlContent += `
      </body>
      </html>
      `;

      let blob = new Blob([htmlContent], {type: "text/html"});
      saveAs(blob, "edited-test.html");
    }
  </script>
</body>
</html>
